<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map | Savyours</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJ87RHvR52yW+O6lP4dF6T3qjR73v2b+Xq7Tz/w/oV6c2C3t/p1l5N8q9q1P3lA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    
</head>
<body class="map-page">
    <header>
        <div class="logo">Savyours</div>
        <label for="menu-checkbox" class="menu-toggle" id="menu-toggle-btn">
    <i class="fas fa-bars"></i>
</label>

        <nav id="main-nav">
    <a href="#">Find Bags</a>
    <a href="#">Business Login</a>
    <a href="#">My Account</a>
</nav>
    </header>

    <main>
        <section class="map-view-section">
            <div id="interactive-map" class="map-container">
                </div>
        </section>
    </main>

    <div class="mobile-nav-bar">
        <a href="index.html">
            <span class="icon"><i class="fas fa-list-ul"></i></span>
            <span>Discover</span>
        </a>
        <a href="map.html" class="active">
            <span class="icon"><i class="fas fa-map-marker-alt"></i></span>
            <span>Map</span>
        </a>
        <a href="favorites.html">
            <span class="icon"><i class="fas fa-star"></i></span>
            <span>Favorites</span>
        </a>
        <a href="orders.html">
            <span class="icon"><i class="fas fa-shopping-bag"></i></span>
            <span>Orders</span>
        </a>
        <a href="profile.html">
            <span class="icon"><i class="fas fa-user-circle"></i></span>
            <span>Profile</span>
        </a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mapElement = document.getElementById('interactive-map');

            if (mapElement) {
                // 1. Map Initialization (Centered near Bandar Seri Begawan)
                var map = L.map('interactive-map').setView([4.9450, 114.9427], 13);

                // 2. Add the Tile Layer (OpenStreetMap)
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                }).addTo(map);

                // 3. Store Data (Coordinates approximate locations near BSB)
                const storeData = [
                    { 
                        name: 'Comfort Greens Cafe (Gadong)', 
                        lat: 4.9200, 
                        lon: 114.9200, 
                        status: '2 Bags Left',
                        price: 'BND 7.00',
                        isSoldOut: false
                    },
                    { 
                        name: 'The Little Leaf Bakery (Kiulap)', 
                        lat: 4.9090, 
                        lon: 114.9350, 
                        status: 'Sold Out',
                        price: 'BND 9.00',
                        isSoldOut: true
                    },
                    { 
                        name: 'Pepper Lunch (Airport Mall)', 
                        lat: 4.9490, 
                        lon: 114.9250, 
                        status: '5 Bags Left',
                        price: 'BND 8.00',
                        isSoldOut: false
                    },
                    { 
                        name: 'Taste of Brunei Bakeries', 
                        lat: 4.9400, 
                        lon: 114.9450, 
                        status: '1 Bag Left',
                        price: 'BND 8.00',
                        isSoldOut: false
                    }
                ];

                // 4. Custom Icon for Active Bags
                var activeBagIcon = L.divIcon({
                    className: 'map-icon-active',
                    html: '<i class="fas fa-shopping-bag" style="color: white; font-size: 14px;"></i><div style="background-color: var(--color-accent); width: 30px; height: 30px; line-height: 30px; text-align: center; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 5px #333;"></div>',
                    iconSize: [30, 30],
                    iconAnchor: [15, 30],
                    popupAnchor: [0, -25]
                });

                // 5. Custom Icon for Sold Out Bags
                var soldOutBagIcon = L.divIcon({
                    className: 'map-icon-soldout',
                    html: '<i class="fas fa-times-circle" style="color: white; font-size: 14px;"></i><div style="background-color: var(--color-sold-out); width: 30px; height: 30px; line-height: 30px; text-align: center; border-radius: 50%; border: 3px solid white; opacity: 0.8; box-shadow: 0 0 5px #333;"></div>',
                    iconSize: [30, 30],
                    iconAnchor: [15, 30],
                    popupAnchor: [0, -25]
                });

                // 6. Add Markers dynamically
                storeData.forEach(store => {
                    const icon = store.isSoldOut ? soldOutBagIcon : activeBagIcon;
                    const popupContent = `
                        <b>${store.name}</b><br>
                        <span style="color: ${store.isSoldOut ? 'var(--color-sold-out)' : 'var(--color-accent)'}; font-weight: bold;">${store.status}</span><br>
                        Price: ${store.price}
                        <hr style="margin: 5px 0;">
                        ${store.isSoldOut ? '<span>Check back tomorrow.</span>' : '<a href="index.html" style="color: var(--color-accent); font-weight: bold;">Reserve Now!</a>'}
                    `;

                    L.marker([store.lat, store.lon], { icon: icon }).addTo(map)
                        .bindPopup(popupContent);
                });

                // 7. User Location (Simulated)
                L.circle([4.9450, 114.9427], {
                    color: 'blue',
                    fillColor: '#30a4ff',
                    fillOpacity: 0.5,
                    radius: 300 
                }).addTo(map).bindPopup("Your Location");
            }
        });
    </script>

</body>
</html>
