<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>jimatbah - Rescue Delicious Food in Brunei</title>
Â  Â  <link rel="stylesheet" href="style.css">
Â  Â  
Â  Â  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
Â  Â  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="dark-mode"> 

Â  Â  <div id="sidebar-menu" class="sidebar">
Â  Â  Â  Â  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
Â  Â  Â  Â  <div class="menu-section">
Â  Â  Â  Â  Â  Â  <h3>Settings</h3>
Â  Â  Â  Â  Â  Â  <a href="#">Account Details</a>
Â  Â  Â  Â  Â  Â  <a href="#">Payment Method</a>
Â  Â  Â  Â  Â  Â  <a href="#">Special Rewards</a>
Â  Â  Â  Â  Â  Â  <a href="#">Notifications</a>
Â  Â  Â  Â  Â  Â  <a href="#" id="theme-toggle-sidebar">
Â  Â  Â  Â  Â  Â  Â  Â  Dark Mode <span class="material-icons theme-icon">dark_mode</span>
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="menu-section">
Â  Â  Â  Â  Â  Â  <h3>Community</h3>
Â  Â  Â  Â  Â  Â  <a href="#">Recommend a Store</a>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="menu-section">
Â  Â  Â  Â  Â  Â  <h3>Support</h3>
Â  Â  Â  Â  Â  Â  <a href="#">Help with an Order</a>
Â  Â  Â  Â  Â  Â  <a href="#">How It Works</a>
Â  Â  Â  Â  Â  Â  <a href="javascript:void(0)" onclick="showScreen('screen-business-signup'); closeNav();">Sign Up Food Business</a>
Â  Â  Â  Â  Â  Â  <a href="#">Careers</a>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="menu-section">
Â  Â  Â  Â  Â  Â  <h3>Others</h3>
Â  Â  Â  Â  Â  Â  <a href="#">Privacy Policy</a>
Â  Â  Â  Â  Â  Â  <a href="#">Terms of Service</a>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="app-container">
Â  Â  Â  Â  
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  Â  <div class="header-top-row">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons menu-icon" onclick="openNav()">menu</span>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="jimatbah-logo-main">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="logo.png" alt="jimatbah Logo" id="app-logo">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="header-icons">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="sholat-time" class="brunei-feature">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons">mosque</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="next-sholat">Next Prayer: Maghrib at 6:15 PM</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons" id="theme-toggle-header">dark_mode</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons">info</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p id="jimatbah-slogan">save money, enjoy great food, and help the planet - all before dinner!</p>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main id="content-area">

Â  Â  Â  Â  Â  Â  <section id="screen-welcome" class="app-screen screen-padding active-screen">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="welcome-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="logo.png" alt="jimatbah Hero Icon" class="welcome-icon">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1>Jimatbah: Rescue Delicious Food</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="section-description">Join thousands in Brunei fighting food waste by rescuing delicious surplus meals, pastries, and produce from local businessesâ€”all at a great price!</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="welcome-stats">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-number">25+</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-label">Partner Stores</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-number">1000+</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-label">Bags Saved</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="cta-button primary" onclick="showScreen('screen-discover');">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Explore Available Bags Now!
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="javascript:void(0)" onclick="openNav()" class="welcome-link">Already a Partner? Sign In.</a>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  <section id="screen-discover" class="app-screen">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="location-bar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons icon-pin">location_on</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" placeholder="Enter your location in Brunei..." value="Bandar Seri Begawan">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons icon-search">search</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Featured Rescues Today</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="banner-carousel">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="banner-card promo">BND 5 Off First Rescue!</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="banner-card impact">You've Saved 25kg COâ‚‚e!</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="banner-card new-store">New Store: Flour Garden Bakery!</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <h2>Available Surprise Bags</h2>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div id="available-bags-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card" data-screen="bag-details" data-store-name="Comfort Greens Cafe" data-location="Gadong" data-available="true" data-cutoff-time="18:30" data-price-new="7.00" data-price-old="21.00" data-pickup-time="6:00 PM - 6:30 PM" onclick="openPurchaseModal(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT4xCYarsb8rvlhM_2AqAu81tD7BKkXxOuHUw&s" alt="Comfort Greens Cafe Surprise Bag" class="bag-image" onerror="this.onerror=null;this.src='https://placehold.co/120x120/00A36C/ffffff?text=Cafe+Bag';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Comfort Greens Cafe (Gadong)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="time-left">Time Left: **1h 30m**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="pickup-time">Pickup: 6:00 PM - 6:30 PM</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="price-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-new">BND 7.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-old">BND 21.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bags-left">2 Bags Left</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card sold-out-card" data-screen="bag-details" data-store-name="The Little Leaf Bakery" data-location="Kiulap" data-available="false" data-cutoff-time="19:00" data-price-new="9.00" data-price-old="27.00" data-pickup-time="7:30 PM - 8:00 PM">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://scontent.fbwn2-1.fna.fbcdn.net/v/t39.30808-6/467467739_591186743471957_1505292326824038053_n.jpg?stp=dst-jpg_s960x960_tt6&_nc_cat=106&ccb=1-7&_nc_sid=cc71e4&_nc_ohc=YFe2y0DZroAQ7kNvwGL34t5&_nc_oc=AdluJ_G_y25BWLXFwXpqIYuMfjKZxyc9JTJgmsoZ11TOXRRXY4XEXz9V92p8pLhQEh0&_nc_zt=23&_nc_ht=scontent.fbwn2-1.fna&_nc_gid=hLzckSZkKXIo7Jafucanrg&oh=00_AfdsgeYj2PcfNP82tYQOfqv8tmFH-O_gfaXhctBtz1s9NQ&oe=68EE61CE" alt="Little Leaf Bakery Surprise Bag" class="bag-image" onerror="this.onerror=null;this.src='https://placehold.co/120x120/A00000/ffffff?text=Sold+Out';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>The Little Leaf Bakery (Kiulap)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="time-left sold-out-text">Time Left: **SOLD OUT**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="pickup-time">Pickup: 7:30 PM - 8:00 PM</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="price-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-new">BND 9.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-old">BND 27.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bags-left sold-out">Sold Out</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card" data-screen="bag-details" data-store-name="Mums Bakery" data-location="Kiulap" data-available="true" data-cutoff-time="17:00" data-price-new="5.00" data-price-old="15.00" data-pickup-time="4:30 PM - 5:00 PM" onclick="openPurchaseModal(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://placehold.co/120x120/FFD700/000000?text=Bakery+Bag" alt="Mums Bakery Surprise Bag" class="bag-image" onerror="this.onerror=null;this.src='https://placehold.co/120x120/FFD700/000000?text=Bakery+Bag';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Mums Bakery (Kiulap)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="time-left">Time Left: **2h 30m**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="pickup-time">Pickup: 4:30 PM - 5:00 PM</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="price-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-new">BND 5.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-old">BND 15.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bags-left">4 Bags Left</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card" data-screen="bag-details" data-store-name="Le Doux Patisserie" data-location="Batu Bersurat" data-available="true" data-cutoff-time="19:30" data-price-new="12.00" data-price-old="36.00" data-pickup-time="7:00 PM - 7:30 PM" onclick="openPurchaseModal(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://placehold.co/120x120/B0E0E6/000000?text=Pastry+Bag" alt="Le Doux Patisserie Surprise Bag" class="bag-image" onerror="this.onerror=null;this.src='https://placehold.co/120x120/B0E0E6/000000?text=Pastry+Bag';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Le Doux Patisserie (Batu Bersurat)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="time-left">Time Left: **4h 00m**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="pickup-time">Pickup: 7:00 PM - 7:30 PM</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="price-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-new">BND 12.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-old">BND 36.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bags-left">1 Bag Left</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card sold-out-card" data-screen="bag-details" data-store-name="coffeeby7t1" data-location="Kiarong" data-available="false" data-cutoff-time="16:00" data-price-new="6.00" data-price-old="18.00" data-pickup-time="3:30 PM - 4:00 PM">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://placehold.co/120x120/A00000/ffffff?text=Sold+Out" alt="coffeeby7t1 Surprise Bag" class="bag-image" onerror="this.onerror=null;this.src='https://placehold.co/120x120/A00000/ffffff?text=Sold+Out';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>coffeeby7t1 (Kiarong)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="time-left sold-out-text">Time Left: **SOLD OUT**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="pickup-time">Pickup: 3:30 PM - 4:00 PM</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="price-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-new">BND 6.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-old">BND 18.00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bags-left sold-out">Sold Out</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card" data-screen="bag-details" data-store-name="Laze Cafe" data-location="Kiulap" data-available="true" data-cutoff-time="20:00" data-price-new="7.50" data-price-old="22.50" data-pickup-time="7:30 PM - 8:00 PM" onclick="openPurchaseModal(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://placehold.co/120x120/ADD8E6/000000?text=Cafe+Dessert" alt="Laze Cafe Surprise Bag" class="bag-image" onerror="this.onerror=null;this.src='https://placehold.co/120x120/ADD8E6/000000?text=Cafe+Dessert';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Laze Cafe (Kiulap)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="time-left">Time Left: **4h 30m**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="pickup-time">Pickup: 7:30 PM - 8:00 PM</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="price-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-new">BND 7.50</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-old">BND 22.50</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bags-left">3 Bags Left</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card" data-screen="bag-details" data-store-name="Namu Korean BBQ and Cafe" data-location="Kg Katok" data-available="true" data-cutoff-time="20:30" data-price-new="9.50" data-price-old="28.50" data-pickup-time="8:00 PM - 8:30 PM" onclick="openPurchaseModal(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://placehold.co/120x120/FF4500/ffffff?text=K-Food+Bag" alt="Namu Korean BBQ Surprise Bag" class="bag-image" onerror="this.onerror=null;this.src='https://placehold.co/120x120/FF4500/ffffff?text=K-Food+Bag';">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Namu Korean BBQ and Cafe (Kg Katok)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="time-left">Time Left: **5h 00m**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="pickup-time">Pickup: 8:00 PM - 8:30 PM</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="price-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-new">BND 9.50</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="price-old">BND 28.50</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bags-left">2 Bags Left</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <section id="screen-business-signup" class="app-screen screen-padding">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Partner with jimatbah ğŸ’š</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="section-description">Join the movement! Sell your surplus food, reduce waste, and reach new customers.</p>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <form id="business-signup-form">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="store-name">Store/Business Name *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="store-name" name="store-name" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="contact-person">Contact Person *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="contact-person" name="contact-person" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="email">Email Address *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="email" name="email" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="phone">Phone Number (WhatsApp Preferred) *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" id="phone" name="phone" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="food-type">Type of Food/Product *</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="food-type" name="food-type" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select Category</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Bakery">Bakery / Pastries</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Cafe">Cafe / Lunch Items</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Restaurant">Restaurant / Dinner Items</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Grocery">Grocery / Produce</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Other">Other</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="message">What time of day do you typically have surplus?</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="message" name="message" rows="4" placeholder="E.g., After 5 PM, or at closing time."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="cta-button primary">Submit Application</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="terms-note">By submitting, you agree to our <a href="#">Partner Terms and Conditions</a>.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  </section>


Â  Â  Â  Â  Â  Â  <section id="screen-map" class="app-screen">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Bags Near You (Interactive Map)</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="interactive-map-full" class="map-view"></div>
Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  <section id="screen-favorites" class="app-screen">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Your Favorite Rescuers ğŸ’–</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card favorite-store">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Comfort Greens Cafe (Gadong)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="store-status">2 Bags available today!</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showScreen('screen-discover')">View Bag</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card favorite-store">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Mums Bakery (Kiulap)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="store-status">4 Bags available today!</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showScreen('screen-discover')">View Bag</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card favorite-store">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Laze Cafe (Kiulap)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="store-status">3 Bags available today!</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showScreen('screen-discover')">View Bag</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bag-card favorite-store faded">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>The Cakery Brunei</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="store-status">No bags currently available.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  <section id="screen-orders" class="app-screen">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>My Orders</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="voucher-section">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Vouchers & Promos</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="voucher-input" placeholder="Enter voucher code (e.g., SAVEYOUR5)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="applyVoucher()">Apply</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="voucher-status"></p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="order-header">Active Order (1)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="order-card active">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Order #BN00123</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>Comfort Greens Cafe (Gadong)</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Pickup Window: **Today, 6:00 PM - 6:30 PM**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="order-total">Total Paid: BND 7.00</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button>View Pickup Code</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="order-header">Past Orders (2)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="order-card past">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Order #BN00122 - Completed</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>Sweet Treats Bakery (Gadong)</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="order-date">Date: 04 Oct 2025</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  <section id="screen-profile" class="app-screen">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>My Profile</h2>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div id="impact-section">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Your Savings & Impact ğŸŒ</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Total Bags Rescued: <span id="bags-count">25</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Money Saved: <span id="money-saved">BND 125.00</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>COâ‚‚e Avoided: <span id="co2-avoided">67.5 kg</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <small>The equivalent of driving a car 250 km!</small>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="profile-links">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Account & Settings</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p onclick="openNav()">Account Details <span class="material-icons">chevron_right</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p onclick="openNav()">Payment Method <span class="material-icons">chevron_right</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="logout-btn">Log Out</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  </main>

Â  Â  Â  Â  <nav id="bottom-nav">
Â  Â  Â  Â  Â  Â  <a href="#" class="nav-item" data-target="discover">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons">explore</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="nav-label">Discover</span>
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <a href="#" class="nav-item" data-target="map">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons">map</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="nav-label">Map</span>
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <a href="#" class="nav-item" data-target="favorites">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons">favorite_border</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="nav-label">Favorites</span>
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <a href="#" class="nav-item" data-target="orders">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons">receipt_long</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="nav-label">Orders</span>
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <a href="#" class="nav-item" data-target="profile">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons">person</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="nav-label">Profile</span>
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  </nav>

Â  Â  </div>

Â  Â  <div id="purchase-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <span class="material-icons close-modal" onclick="closePurchaseModal()">close</span>
Â  Â  Â  Â  Â  Â  <h2>Confirm Your Rescue</h2>
Â  Â  Â  Â  Â  Â  <div id="modal-bag-info">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="modal-store-name">Store Name</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="modal-location-time"></p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="price-details-modal">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>You Pay: <span id="modal-price-new" class="price-new-modal">BND 0.00</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Original Value: <span id="modal-price-old" class="price-old-modal">BND 0.00</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Quantity: <select id="modal-quantity-select" onchange="updateModalTotal()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="1">1 Bag</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="2">2 Bags</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select></p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="modal-note">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><span class="material-icons">info</span> **Note:** Contents are a surprise! Bags contain perfectly good food that would otherwise go to waste.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="modal-total-section">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>Total Due: <span id="modal-total-amount">BND 0.00</span></h4>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button id="reserve-button" onclick="reserveBag()">Reserve & Pay Now</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  
Â  Â  <div id="success-animation-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="success-content">
Â  Â  Â  Â  Â  Â  <div class="checkmark-circle">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-icons checkmark-icon">check</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <h2>Rescue Confirmed!</h2>
Â  Â  Â  Â  Â  Â  <p id="success-message">Your surprise bag is reserved. Check your orders tab for the pickup code!</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="overlay" onclick="closeNav()"></div>
Â  Â  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
Â  Â  
Â  Â  <script>
Â  Â  Â  Â  // Store the map instance and tile layer instance globally
let mapInstance = null;
let tileLayerInstance = null; 
let currentBagData = {}; // Global object to hold the data of the bag currently in the modal


// --- GLOBAL NAVIGATION FUNCTION ---
window.showScreen = function(targetId) {
Â  Â  const navItems = document.querySelectorAll('#bottom-nav .nav-item');
Â  Â  const appScreens = document.querySelectorAll('.app-screen');

Â  Â  // Deactivate all screens
Â  Â  appScreens.forEach(screen => screen.classList.remove('active-screen'));

Â  Â  // Activate the selected screen
Â  Â  const targetScreen = document.getElementById(targetId);
Â  Â  if (targetScreen) {
Â  Â  Â  Â  targetScreen.classList.add('active-screen');
Â  Â  Â  Â  document.getElementById('content-area').scrollTop = 0; // Scroll to top

Â  Â  Â  Â  // If switching to a main nav screen, update the bottom navigation icons
Â  Â  Â  Â  const mainNavTargets = ['discover', 'map', 'favorites', 'orders', 'profile'];
Â  Â  Â  Â  const targetNav = targetId.replace('screen-', '');

Â  Â  Â  Â  navItems.forEach(nav => nav.classList.remove('active'));

Â  Â  Â  Â  if (mainNavTargets.includes(targetNav)) {
Â  Â  Â  Â  Â  Â  const activeNavItem = document.querySelector(`#bottom-nav .nav-item[data-target="${targetNav}"]`);
Â  Â  Â  Â  Â  Â  if (activeNavItem) {
Â  Â  Â  Â  Â  Â  Â  Â  activeNavItem.classList.add('active');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Special handling for the map screen
Â  Â  Â  Â  if (targetId === 'screen-map') {
Â  Â  Â  Â  Â  Â  // Need a slight delay to ensure the screen is visible before Leaflet checks container size
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  initializeLeafletMap();
Â  Â  Â  Â  Â  Â  Â  Â  reinitializeLeafletMap(); 
Â  Â  Â  Â  Â  Â  }, 100);
Â  Â  Â  Â  }
Â  Â  }
}


document.addEventListener('DOMContentLoaded', () => {

Â  Â  // --- 0. THEME TOGGLE LOGIC ---
Â  Â  const body = document.body;
Â  Â  const themeToggleHeader = document.getElementById('theme-toggle-header');
Â  Â  const themeToggleSidebar = document.getElementById('theme-toggle-sidebar');
Â  Â  const rootStyle = getComputedStyle(document.documentElement);

Â  Â  // Initialize theme from localStorage, default to 'dark-mode'
Â  Â  const savedTheme = localStorage.getItem('jimatbah-theme') || 'dark-mode';
Â  Â  body.classList.remove('dark-mode', 'light-mode');
Â  Â  body.classList.add(savedTheme);
Â  Â  updateThemeToggleIcons(savedTheme);

Â  Â  function updateThemeToggleIcons(currentTheme) {
Â  Â  Â  Â  const iconElement = themeToggleSidebar ? themeToggleSidebar.querySelector('.theme-icon') : null;
Â  Â  Â  Â  
Â  Â  Â  Â  if (currentTheme === 'dark-mode') {
Â  Â  Â  Â  Â  Â  themeToggleHeader.textContent = 'dark_mode';
Â  Â  Â  Â  Â  Â  if (iconElement && themeToggleSidebar.firstChild) {
Â  Â  Â  Â  Â  Â  Â  Â  iconElement.textContent = 'dark_mode';
Â  Â  Â  Â  Â  Â  Â  Â  // Update text node content
Â  Â  Â  Â  Â  Â  Â  Â  themeToggleSidebar.childNodes[0].nodeValue = 'Dark Mode ';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  themeToggleHeader.textContent = 'light_mode';
Â  Â  Â  Â  Â  Â  if (iconElement && themeToggleSidebar.firstChild) {
Â  Â  Â  Â  Â  Â  Â  Â  iconElement.textContent = 'light_mode';
Â  Â  Â  Â  Â  Â  Â  Â  // Update text node content
Â  Â  Â  Â  Â  Â  Â  Â  themeToggleSidebar.childNodes[0].nodeValue = 'Light Mode ';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function toggleTheme() {
Â  Â  Â  Â  const isDarkMode = body.classList.contains('dark-mode');
Â  Â  Â  Â  const newTheme = isDarkMode ? 'light-mode' : 'dark-mode';
Â  Â  Â  Â  body.classList.remove('dark-mode', 'light-mode');
Â  Â  Â  Â  body.classList.add(newTheme);
Â  Â  Â  Â  localStorage.setItem('jimatbah-theme', newTheme);
Â  Â  Â  Â  updateThemeToggleIcons(newTheme);

Â  Â  Â  Â  // Re-initialize map on theme change
Â  Â  Â  Â  if (mapInstance) {
Â  Â  Â  Â  Â  Â  reinitializeLeafletMap();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  themeToggleHeader.addEventListener('click', toggleTheme);
Â  Â  if (themeToggleSidebar) {
Â  Â  Â  Â  themeToggleSidebar.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  toggleTheme();
Â  Â  Â  Â  Â  Â  closeNav();
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // --- 1. NAVIGATION LOGIC --- 
Â  Â  const navItems = document.querySelectorAll('#bottom-nav .nav-item');
Â  Â  navItems.forEach(item => {
Â  Â  Â  Â  item.addEventListener('click', function(event) {
Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  const targetId = `screen-${this.getAttribute('data-target')}`;
Â  Â  Â  Â  Â  Â  window.showScreen(targetId);
Â  Â  Â  Â  Â  Â  closeNav();
Â  Â  Â  Â  });
Â  Â  });

Â  Â  // --- 2. HAMBURGER MENU (SIDEBAR) LOGIC ---
Â  Â  window.openNav = function() {
Â  Â  Â  Â  document.getElementById("sidebar-menu").style.width = "280px";
Â  Â  Â  Â  const overlay = document.getElementById("overlay");
Â  Â  Â  Â  if (overlay) {
Â  Â  Â  Â  Â  Â  overlay.style.display = "block";
Â  Â  Â  Â  Â  Â  setTimeout(() => { overlay.style.opacity = "1"; }, 10);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  window.closeNav = function() {
Â  Â  Â  Â  document.getElementById("sidebar-menu").style.width = "0";
Â  Â  Â  Â  const overlay = document.getElementById("overlay");
Â  Â  Â  Â  if (overlay) {
Â  Â  Â  Â  Â  Â  overlay.style.opacity = "0";
Â  Â  Â  Â  Â  Â  setTimeout(() => { overlay.style.display = "none"; }, 300);
Â  Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  // --- 3. PURCHASE MODAL LOGIC ---
Â  Â  // Note: The `priceNew` data attribute must be a string that can be parsed as a float (e.g., "7.00").
Â  Â  window.openPurchaseModal = function(cardElement) {
Â  Â  Â  Â  const storeName = cardElement.getAttribute('data-store-name');
Â  Â  Â  Â  const location = cardElement.getAttribute('data-location');
Â  Â  Â  Â  const pickupTime = cardElement.getAttribute('data-pickup-time');
Â  Â  Â  Â  const priceNew = parseFloat(cardElement.getAttribute('data-price-new'));
Â  Â  Â  Â  const priceOld = cardElement.getAttribute('data-price-old');

Â  Â  Â  Â  currentBagData = { storeName, priceNew }; // Store essential data globally

Â  Â  Â  Â  document.getElementById('modal-store-name').textContent = storeName;
Â  Â  Â  Â  document.getElementById('modal-location-time').textContent = `Pickup: ${pickupTime} (${location})`;
Â  Â  Â  Â  document.getElementById('modal-price-new').textContent = `BND ${priceNew.toFixed(2)}`;
Â  Â  Â  Â  document.getElementById('modal-price-old').textContent = `BND ${priceOld}`;
Â  Â  Â  Â  document.getElementById('modal-quantity-select').value = 1; // Reset quantity
Â  Â  Â  Â  
Â  Â  Â  Â  updateModalTotal(); // Calculate initial total

Â  Â  Â  Â  document.getElementById('purchase-modal').classList.add('active');
Â  Â  }

Â  Â  window.closePurchaseModal = function() {
Â  Â  Â  Â  document.getElementById('purchase-modal').classList.remove('active');
Â  Â  }

Â  Â  window.updateModalTotal = function() {
Â  Â  Â  Â  const priceNew = currentBagData.priceNew;
Â  Â  Â  Â  const quantity = parseInt(document.getElementById('modal-quantity-select').value);
Â  Â  Â  Â  const total = priceNew * quantity;
Â  Â  Â  Â  document.getElementById('modal-total-amount').textContent = `BND ${total.toFixed(2)}`;
Â  Â  }
Â  Â  
Â  Â  // --- 4. RESERVE BAG & SUCCESS ANIMATION LOGIC (UPDATED) ---
Â  Â  window.reserveBag = function() {
Â  Â  Â  Â  const store = currentBagData.storeName;
Â  Â  Â  Â  const quantity = document.getElementById('modal-quantity-select').value;
Â  Â  Â  Â  const total = document.getElementById('modal-total-amount').textContent;
Â  Â  Â  Â  const successModal = document.getElementById('success-animation-modal');
Â  Â  Â  Â  const successMessage = document.getElementById('success-message');

Â  Â  Â  Â  // 1. Close the Purchase Modal immediately
Â  Â  Â  Â  closePurchaseModal();

Â  Â  Â  Â  // 2. Update the success message
Â  Â  Â  Â  successMessage.innerHTML = `You secured ${quantity} bag(s) from <b>${store}</b> for ${total}. Check your orders tab for the pickup code!`;

Â  Â  Â  Â  // 3. Show the success animation modal
Â  Â  Â  Â  successModal.classList.add('active');

Â  Â  Â  Â  // 4. Set a timer to automatically hide the success modal and switch screens
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  successModal.classList.remove('active');
Â  Â  Â  Â  Â  Â  window.showScreen('screen-orders'); // Automatically switch to the orders screen
Â  Â  Â  Â  }, 2000); // Animation displays for 2 seconds (2000ms)
Â  Â  }


Â  Â  // --- 5. VOUCHER LOGIC ---
Â  Â  window.applyVoucher = function() {
Â  Â  Â  Â  const input = document.getElementById('voucher-input');
Â  Â  Â  Â  const status = document.querySelector('.voucher-status');
Â  Â  Â  Â  if (input.value.toUpperCase() === 'SAVEYOUR5') {
Â  Â  Â  Â  Â  Â  status.textContent = 'SAVEYOUR5 applied! BND 5.00 discount will be applied at checkout.';
Â  Â  Â  Â  Â  Â  status.classList.add('success');
Â  Â  Â  Â  } else if (input.value.trim() === '') {
Â  Â  Â  Â  Â  Â  status.textContent = '';
Â  Â  Â  Â  Â  Â  status.classList.remove('success');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  status.textContent = 'Invalid voucher code.';
Â  Â  Â  Â  Â  Â  status.classList.remove('success');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- 6. LEAFLET MAP LOGIC (UPDATED MARKERS) ---
Â  Â  const markers = [
Â  Â  Â  Â  { name: "Comfort Greens Cafe", lat: 4.8895, lon: 114.9398, available: true, pickup: "6:00 PM - 6:30 PM", price: "BND 7.00" },
Â  Â  Â  Â  { name: "The Little Leaf Bakery", lat: 4.8870, lon: 114.9213, available: false, pickup: "7:30 PM - 8:00 PM", price: "BND 9.00" },
Â  Â  Â  Â  { name: "Mums Bakery", lat: 4.8998, lon: 114.9285, available: true, pickup: "4:30 PM - 5:00 PM", price: "BND 5.00" },
Â  Â  Â  Â  { name: "Le Doux Patisserie", lat: 4.9120, lon: 114.9210, available: true, pickup: "7:00 PM - 7:30 PM", price: "BND 12.00" },
Â  Â  Â  Â  { name: "coffeeby7t1", lat: 4.9030, lon: 114.9200, available: false, pickup: "3:30 PM - 4:00 PM", price: "BND 6.00" },
Â  Â  Â  Â  { name: "Laze Cafe", lat: 4.9032, lon: 114.9310, available: true, pickup: "7:30 PM - 8:00 PM", price: "BND 7.50" },
Â  Â  Â  Â  { name: "Namu Korean BBQ and Cafe", lat: 4.9500, lon: 114.9000, available: true, pickup: "8:00 PM - 8:30 PM", price: "BND 9.50" },
Â  Â  ];

Â  Â  function getCustomIcon(marker) {
Â  Â  Â  Â  // Use CSS variables for color consistency
Â  Â  Â  Â  const isAvailable = marker.available;
Â  Â  Â  Â  const color = isAvailable ? `var(--primary-color)` : `var(--color-sold-out)`;
Â  Â  Â  Â  const className = isAvailable ? 'map-icon-active' : 'map-icon-soldout';
Â  Â  Â  Â  const icon = isAvailable ? 'restaurant' : 'not_interested';
Â  Â  Â  Â  
Â  Â  Â  Â  const iconHtml = `
Â  Â  Â  Â  Â  Â  <div style="background-color: ${color}; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 30px; height: 30px; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  border-radius: 50%; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: white; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  display: flex; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justify-content: center; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  align-items: center; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  font-size: 16px;">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="material-icons">${icon}</i>
Â  Â  Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  return L.divIcon({
Â  Â  Â  Â  Â  Â  className: className,
Â  Â  Â  Â  Â  Â  html: iconHtml,
Â  Â  Â  Â  Â  Â  iconSize: [30, 30],
Â  Â  Â  Â  Â  Â  iconAnchor: [15, 15],
Â  Â  Â  Â  Â  Â  popupAnchor: [0, -15]
Â  Â  Â  Â  });
Â  Â  }

Â  Â  window.initializeLeafletMap = function() {
Â  Â  Â  Â  if (!mapInstance) {
Â  Â  Â  Â  Â  Â  mapInstance = L.map('interactive-map-full', {
Â  Â  Â  Â  Â  Â  Â  Â  center: [4.945, 114.945], // Center near Bandar Seri Begawan
Â  Â  Â  Â  Â  Â  Â  Â  zoom: 13,
Â  Â  Â  Â  Â  Â  Â  Â  maxZoom: 17,
Â  Â  Â  Â  Â  Â  Â  Â  minZoom: 12,
Â  Â  Â  Â  Â  Â  Â  Â  zoomControl: false 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  updateMapTiles(document.body.classList.contains('dark-mode'));

Â  Â  Â  Â  Â  Â  markers.forEach(marker => {
Â  Â  Â  Â  Â  Â  Â  Â  const popupContent = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b>${marker.name}</b><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${marker.available ? `<span style="color:var(--primary-color); font-weight:bold;">Available: ${marker.price}</span>` : `<span style="color:var(--color-sold-out); font-weight:bold;">Sold Out</span>`}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Pickup: ${marker.pickup}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <hr style="margin: 5px 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="showScreen('screen-discover')">View Details</a>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  L.marker([marker.lat, marker.lon], { icon: getCustomIcon(marker) })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .bindPopup(popupContent)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .addTo(mapInstance);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  }

Â  Â  window.reinitializeLeafletMap = function() {
Â  Â  Â  Â  if (mapInstance) {
Â  Â  Â  Â  Â  Â  mapInstance.invalidateSize();
Â  Â  Â  Â  Â  Â  updateMapTiles(document.body.classList.contains('dark-mode'));
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function updateMapTiles(isDarkMode) {
Â  Â  Â  Â  const lightUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
Â  Â  Â  Â  const darkUrl = 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'; 
Â  Â  Â  Â  
Â  Â  Â  Â  if (tileLayerInstance) {
Â  Â  Â  Â  Â  Â  mapInstance.removeLayer(tileLayerInstance);
Â  Â  Â  Â  }

Â  Â  Â  Â  const tileUrl = isDarkMode ? darkUrl : lightUrl;
Â  Â  Â  Â  tileLayerInstance = L.tileLayer(tileUrl, {
Â  Â  Â  Â  Â  Â  attribution: isDarkMode ? 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> | Tiles &copy; <a href="https://carto.com/attributions">Carto</a>' : 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
Â  Â  Â  Â  Â  Â  maxZoom: 19
Â  Â  Â  Â  }).addTo(mapInstance);

Â  Â  Â  Â  mapInstance.eachLayer(function(layer) {
Â  Â  Â  Â  Â  Â  if (layer instanceof L.Marker) {
Â  Â  Â  Â  Â  Â  Â  Â  // Find original marker data to correctly update icon color
Â  Â  Â  Â  Â  Â  Â  Â  const popupContent = layer.getPopup().getContent();
Â  Â  Â  Â  Â  Â  Â  Â  // Simple way to extract name from the custom popup HTML
Â  Â  Â  Â  Â  Â  Â  Â  const markerNameMatch = popupContent.match(/<b>(.*?)<\/b>/);
Â  Â  Â  Â  Â  Â  Â  Â  if (markerNameMatch && markerNameMatch[1]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const markerName = markerNameMatch[1];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const markerData = markers.find(m => m.name === markerName);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (markerData) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.setIcon(getCustomIcon(markerData));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.setZIndexOffset(900); 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // --- 7. Business Signup Form Handler ---
Â  Â  const signupForm = document.getElementById('business-signup-form');
Â  Â  if (signupForm) {
Â  Â  Â  Â  signupForm.addEventListener('submit', function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const storeName = document.getElementById('store-name').value;
Â  Â  Â  Â  Â  Â  alert(`Thank you, ${storeName}! Your application has been submitted successfully. We will be in touch shortly.`);
Â  Â  Â  Â  Â  Â  signupForm.reset();
Â  Â  Â  Â  Â  Â  window.showScreen('screen-discover');
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // --- INITIALIZATION ---
Â  Â  // The screen-welcome already has the 'active-screen' class in the HTML.
Â  Â  // Ensure the bottom nav reflects the initial state (Discover) after the Welcome screen is dismissed.
Â  Â  const discoverNav = document.querySelector('#bottom-nav .nav-item[data-target="discover"]');
Â  Â  if (discoverNav) {
Â  Â  Â  Â  Â discoverNav.classList.add('active'); // Start Discov
Â  Â  }
});
Â  Â  </script>

</body>
</html>
